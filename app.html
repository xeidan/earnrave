<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EarnRave App</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">
  <link href="output.css" rel="stylesheet" />
  <link rel="stylesheet" href="input.css">
  <script src="https://cdn.tailwindcss.com"></script>

</head>
<body class="bg-black text-white font-sans min-h-screen flex flex-col">

  <header class="flex justify-between items-center px-4 py-4 sticky top-0 z-50 bg-black/80 backdrop-blur-sm border-b border-white/10">
    <div class="flex items-center space-x-3">
      <div class="w-12 h-12 flex-shrink-0 flex items-center justify-center rounded-full border border-white/20 bg-transparent">
        <i class="fa-solid fa-user text-xl text-white/70"></i>
      </div>
      <div>
        <p class="text-sm text-gray-300 font-semibold">Hello, <span id="account-user-email">email@email.com</span></p>
        <p class="text-sm text-white/70">ID: <span id="user-id-display">#RAVE000001</span></p>
        <p class="text-xs text-white/50">Welcome back</p>
      </div>
    </div>
    <div class="flex items-center space-x-4">
      <button id="notification-btn" class="text-white/70 hover:text-white text-lg">
        <i class="fa-solid fa-bell"></i>
      </button>
      <button id="guide-btn" class="text-white/70 hover:text-white text-lg">
        <i class="fa-solid fa-circle-question"></i>
      </button>
    </div>
  </header>

  
  <!-- Notification Modal -->
  <div id="notification-modal" class="fixed inset-0 bg-black bg-opacity-90 text-white flex flex-col p-6 hidden z-40 transition-transform duration-300 transform translate-y-full">
    <div class="flex-grow flex flex-col justify-center items-center text-center mt-16">
      <i class="fa-solid fa-bell text-4xl text-cyan-400 mb-4"></i>
      <h3 class="text-xl font-bold mb-1">No Notifications</h3>
      <p class="text-sm text-white/60">You have yet to receive any notifications.</p>
    </div>
    <button onclick="document.getElementById('notification-modal').classList.add('hidden'); document.getElementById('notification-modal').classList.add('translate-y-full');" class="mb-12 self-center text-white/70 text-3xl font-bold z-40">
      &times;
    </button>
  </div>
  
  <!-- Guide Modal -->
  <div id="guide-modal" class="fixed inset-0 bg-black bg-opacity-80 backdrop-blur-sm flex flex-col p-6 hidden z-40">
    <div class="flex-grow flex flex-col justify-center items-center text-center mt-16">
      <div class="bg-white/5 text-white border border-white/10 rounded-xl p-6 w-full max-w-md">
        <div class="aspect-video bg-black/20 border border-white/10 rounded-lg mb-4 flex items-center justify-center text-white/30">
          <span>Video Placeholder</span>
        </div>
        <p class="text-sm text-white/70 mb-4">
          Welcome to the platform. Here you can trade assets, monitor your positions, and earn by referring others. Use the tabs below to navigate through the app.
        </p>
      </div>
    </div>
    <button onclick="document.getElementById('guide-modal').classList.add('hidden')" class="mb-12 self-center text-white/70 text-3xl font-bold z-40">&times;</button>
  </div>
  
  <script>
    const notificationBtn = document.getElementById("notification-btn");
    const notificationModal = document.getElementById("notification-modal");
    notificationBtn.addEventListener("click", () => {
      notificationModal.classList.toggle("hidden");
      setTimeout(() => {
        notificationModal.classList.toggle("translate-y-full");
      }, 10);
    });
  
    document.getElementById("guide-btn").addEventListener("click", () => {
  // Close notification modal if it's open
  notificationModal.classList.add("hidden");
  notificationModal.classList.add("translate-y-full");

  // Then show the guide modal
  document.getElementById("guide-modal").classList.remove("hidden");
});
  </script>


<main class="flex-1">
  <!-- HUB -->
  <section id="tab-hub" class="tab-content px-4 py-6">
    <div class="space-y-6">
      <!-- Total Asset Display -->
      <div class="bg-white/5 border border-white/10 rounded-xl p-4 space-y-2 shadow-lg">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-xs text-white/70">Your Total Asset</p>
            <h2 id="real-balance-amount" class="text-3xl font-extrabold text-white">$0.00</h2>
          </div>
          <button onclick="toggleBalance()">
            <i id="real-balance-eye-icon" class="fa-solid fa-eye text-white/70 text-lg"></i>
          </button>
        </div>
        <div class="flex items-center space-x-4 text-cyan-400 text-sm font-semibold pt-1">
          <div id="percentage-increase"><i class="fa-solid fa-arrow-up"></i> +0.0%</div>
          <div id="profit-increase">+$0.00</div>
        </div>
        <div>
          <p class="text-xs text-white/60">Available Balance</p>
          <p id="real-available-balance" class="text-xl font-semibold text-white">$0.00</p>
        </div>
        <div>
          <p class="text-xs text-white/60">Referral Balance</p>
          <p id="referral-balance" class="text-xl font-semibold text-white">$0.00</p>
        </div>
      </div>
  
      <!-- Action Buttons -->
      <div class="flex justify-around py-10">
        <div class="flex flex-col items-center">
          <div class="w-14 h-14 flex items-center justify-center bg-white rounded-xl text-black text-xl cursor-pointer" data-action="deposit">
            <i class="fa-solid fa-plus"></i>
          </div>
          <p class="mt-2 text-xs font-light">Deposit</p>
        </div>
        <div class="flex flex-col items-center">
          <div class="w-14 h-14 flex items-center justify-center bg-white/5 border border-white/10 rounded-xl text-white text-xl cursor-pointer" data-action="withdraw">
            <i class="fa-solid fa-minus"></i>
          </div>
          <p class="mt-2 text-xs font-light">Withdraw</p>
        </div>
        <div class="flex flex-col items-center">
          <div class="w-14 h-14 flex items-center justify-center bg-white/5 border border-white/10 rounded-xl text-white text-xl cursor-pointer" data-action="transactions">
            <i class="fa-solid fa-arrow-right-arrow-left"></i>
          </div>
          <p class="mt-2 text-xs font-light">Transactions</p>
        </div>
      </div>
      
  
      <!-- Refer and Earn Promo -->
      <hr class="border-white/10">
      <div class="bg-gradient-to-br from-cyan-700 to-cyan-900 border border-cyan-600 rounded-xl px-4 py-10 text-center">
        <h3 class="text-xl font-bold mb-2">Refer a Friend, Earn Big!</h3>
        <p class="text-sm text-green-100 mb-4">
          Get <span class="font-bold text-cyan-200">5% of their first deposit</span> when they register and fund their account.
        </p>
        <button onclick="showTab('tab-earn')" class="bg-white text-black px-6 py-2 rounded-lg font-semibold hover:bg-gray-100 transition-colors duration-200">
          Refer Now
        </button>
      </div>
    </div>
  </section>
  


  <!-- EARN -->
  <section id="tab-earn" class="tab-content hidden px-4 py-6">
    <h1 class="text-2xl font-bold mb-4 text-center">Your Referral Stats</h1>
  
    <div id="referral-info" class="bg-white/5 border border-white/10 rounded-xl p-4 mb-6 space-y-2">
      <p>Referral Code: <span id="referral-code" class="font-mono text-cyan-400"></span></p>
  
      <div class="flex items-center gap-2">
        <p>Referral Link:</p>
        <span id="referral-link" class="font-mono text-cyan-400 text-sm truncate"></span>
        <button id="copy-btn" class="text-white/70 hover:text-white text-xs border border-white/20 px-2 py-1 rounded">Copy</button>
      </div>
  
      <p id="copy-status" class="text-green-400 text-sm hidden">Copied!</p>
  
      <div class="pt-4 space-y-2 text-white text-sm">
        <p>Total Referrals: <span id="referral-count" class="font-semibold text-white/80">0</span></p>
        <p>Referral Earnings: <span id="account-referral-earnings" class="font-bold text-green-400">$0.00</span></p>
      </div>
    </div>
  
    <h2 class="text-xl font-bold mb-3">Leaderboard</h2>
    <ul id="leaderboard" class="space-y-3"></ul>
  </section>
  


  <!-- TRADE -->
  <section id="tab-trade" class="tab-content hidden px-4 py-6 h-[calc(100vh-120px)] overflow-y-auto">
    <div class="max-w-md mx-auto text-white space-y-6">
  
      <!-- AI Auto Trader Card -->
      <div class="bg-white/5 border border-white/10 rounded-xl p-4">
        <h2 class="text-xl font-bold mb-2">AI Auto Trader</h2>
        <div class="text-sm text-white/70 flex justify-between mt-2">
          <span>Capital:</span><span id="bot-capital">$0</span>
        </div>
        <div class="text-sm text-white/70 flex justify-between">
          <span>Days Active:</span><span id="bot-days">0</span>
        </div>
        <div class="text-sm text-white/70 flex justify-between">
          <span>Projected Profit:</span><span id="bot-profit">$0</span>
        </div>
  
        <!-- Neon Progress bar -->
        <div class="mt-4">
          <p class="text-xs text-white/50 mb-1">Progress to 20% Goal</p>
          <div class="relative w-full h-2 rounded-full bg-white/10 overflow-hidden neon-track">
            <div id="bot-progress" class="absolute h-full left-0 top-0 neon-fill" style="width: 50%"></div>
          </div>
          <p id="bot-progress-label" class="text-xs text-white/70 text-right mt-1">50%</p>
        </div>
      </div>  

      <!-- Live Price Row -->
<div class="flex justify-between items-center px-4 py-2 border-b border-white/10 text-white/70 text-sm">
  <span>Live Volatility 75 Index Price:</span>
  <span class="flex items-center gap-1 font-bold" id="vix75-container">
    <span id="vix75-price" class="text-cyan-400">$0.00</span>
    <span id="vix75-arrow" class="text-xs"></span>
  </span>
</div>

<!-- Sparkline -->
<div class="px-4 pb-2">
  <canvas id="vix75-sparkline" height="30"></canvas>
</div>


      
      <!-- Trade History Table -->
<div class="bg-white/5 border border-white/10 rounded-xl">

  <!-- Table with scrollable body -->
  <div class="max-h-72 overflow-y-auto">
    <table class="min-w-full text-left text-sm">
      <thead class="sticky top-0 bg-white/10 text-white text-xs uppercase z-10">
        <tr>
          <th class="px-2 py-2">Time</th>
          <th class="px-2 py-2">Lost</th>
          <th class="px-2 py-2">Won</th>
          <th class="px-2 py-2">Stake</th>
          <th class="px-2 py-2">Buy Price</th>
          <th class="px-2 py-2">Status</th>
        </tr>
      </thead>
      <tbody id="trade-history" class="text-white/80"></tbody>
    </table>
  </div>
</div>


      <!-- Bot Controls -->
      <div class="bg-white/5 border border-white/10 rounded-xl p-4 flex justify-between items-center space-y-4">
        <div class="w-full">      
          <p id="bot-action-label" class="text-sm text-white/70 mb-1">Buying Contract</p>
          <div class="relative w-full h-2 rounded-full bg-white/10 overflow-hidden neon-track">
      <div id="bot-loop-progress" class="absolute h-full left-0 top-0 neon-fill" style="width: 33%"></div>
          </div>
        </div>
        <button id="start-bot" class="ml-4 py-2 w-48 px-4 bg-cyan-400 hover:bg-cyan-300 text-black font-bold rounded-lg flex items-center gap-2">
          <i class="fas fa-play"></i> <span>Start Bot</span>
        </button>
      </div>

  
      <p class="text-xs text-white/50 text-center pt-4">Bot executes trades daily and grows your balance by 20% over 30 days.</p>
  
      <!-- Confirmation Modal -->
      <div id="stop-modal" class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center z-50 flex">
        <div class="bg-white text-black rounded-xl p-6 max-w-sm text-center animate__animated animate__fadeInUp">
          <h3 class="text-lg font-bold mb-2">Stop Bot?</h3>
          <p class="text-sm text-gray-700 mb-4">You’ll lose all progress and profit if you stop the bot now. Are you sure?</p>
          <div class="flex justify-center gap-4">
            <button id="cancel-stop" class="px-4 py-2 rounded bg-gray-300 hover:bg-gray-400">Cancel</button>
            <button id="confirm-stop" class="px-4 py-2 rounded bg-red-500 hover:bg-red-600 text-white">Stop Bot</button>
          </div>
        </div>
      </div>
    </div>
  </section>
  


  <!-- POSITIONS -->
  <!-- <section id="tab-positions" class="tab-content hidden px-4 py-6">
    <div class="max-w-md mx-auto text-white space-y-6">
      <h3 class="text-sm text-gray-400 mb-2">Running Positions (Today)</h3>
      <ul id="running-positions-list" class="mb-4 space-y-1"></ul>

      <h3 class="text-sm text-gray-400 mb-2">Closed Positions (Earlier)</h3>
      <ul id="closed-positions-list" class="space-y-1"></ul>

    </div>
  </section>   -->


  <!-- ACCOUNT -->
  <section id="tab-account" class="tab-content hidden px-4 py-6">
    <div class="max-w-md mx-auto text-white space-y-6">

  
      <!-- Account Options -->
      <div class="bg-white/5 border border-white/10 rounded-xl p-4 divide-y divide-white/10">
        <div class="py-3 flex justify-between items-center">
          <span class="text-white/80">Join Telegram Community</span>
          <i class="fa-brands fa-telegram text-cyan-400 text-lg"></i>
        </div>
        <div class="py-3 flex justify-between items-center">
          <span class="text-white/80">Install Web App</span>
          <i class="fa-solid fa-download text-cyan-400 text-lg"></i>
        </div>
        <div class="py-3 flex justify-between items-center">
          <span class="text-white/80">Edit Profile</span>
          <i class="fa-solid fa-user-pen text-cyan-400 text-lg"></i>
        </div>
        <div class="py-3 flex justify-between items-center">
          <span class="text-white/80">KYC Verification</span>
          <span class="text-xs px-2 py-1 bg-yellow-500/20 text-yellow-300 rounded-lg font-semibold">Pending</span>
        </div>
        <div class="py-3 flex justify-between items-center">
          <span class="text-white/80">Security Settings</span>
          <i class="fa-solid fa-shield-halved text-cyan-400 text-lg"></i>
        </div>
        <div class="py-3 flex justify-between items-center">
          <span class="text-white/80">Notification Preferences</span>
          <i class="fa-solid fa-bell text-cyan-400 text-lg"></i>
        </div>
        <div class="py-3 flex justify-between items-center">
          <span class="text-white/80">Contact Support</span>
          <i class="fa-solid fa-headset text-cyan-400 text-lg"></i>
        </div>
        <div class="py-3 flex justify-between items-center">
          <span class="text-white/80">Terms & Policies</span>
          <i class="fa-solid fa-file-contract text-cyan-400 text-lg"></i>
        </div>
        <div class="py-3 flex justify-between items-center">
          <span class="text-red-400 font-bold">Log Out</span>
          <i class="fa-solid fa-arrow-right-from-bracket text-red-400 text-lg"></i>
        </div>
      </div>
  
      <!-- App Info -->
      <div class="text-xs text-white/50 text-center pt-4">
        EarnRave v1.0.0 • Last updated: Jun 2025<br>
        Built for smart traders. Powered by AI.
      </div>
    </div>
  </section>
    
</main>


  <!-- NAV -->
<nav class="fixed bottom-0 left-0 right-0 border-t border-white/10 flex justify-around py-3 text-xs font-light bg-black/80 backdrop-blur-sm z-20">
  <button id="nav-hub" onclick="showTab('tab-hub')" class="tab-btn flex flex-col items-center justify-center text-cyan-400 w-1/5">
    <i class="fa-solid fa-house text-lg mb-1"></i>
    <span>Hub</span>
  </button>
  <button id="nav-earn" onclick="showTab('tab-earn')" class="tab-btn flex flex-col items-center justify-center text-white/50 w-1/5">
    <i class="fa-solid fa-coins text-lg mb-1"></i>
    <span>Earn</span>
  </button>
  <button id="nav-trade" onclick="showTab('tab-trade')" class="tab-btn flex flex-col items-center justify-center text-white/50 w-1/5">
    <i class="fa-solid fa-arrow-trend-up text-lg mb-1"></i>
    <span>Trade</span>
  </button>
  <!-- <button id="nav-positions" onclick="showTab('tab-positions')" class="tab-btn flex flex-col items-center justify-center text-white/50 w-1/5">
    <i class="fa-solid fa-briefcase text-lg mb-1"></i>
    <span>Positions</span>
  </button> -->
  <button id="nav-account" onclick="showTab('tab-account')" class="tab-btn flex flex-col items-center justify-center text-white/50 w-1/5">
    <i class="fa-solid fa-user text-lg mb-1"></i>
    <span>Account</span>
  </button>
</nav>


  <!-- GLOBAL JS -->
  <script id="global-script">
    const user = JSON.parse(localStorage.getItem("user")) || { id: 1, email: "user@site.com" };
  
    function formatUserId(id) {
      const base = 150000;
      return `#RAVE${base + parseInt(id)}`;
    }
  
    function showTab(tabId) {
      document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
      document.getElementById(tabId).classList.remove('hidden');
  
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('text-cyan-400');
        btn.classList.add('text-white/50');
      });
  
      const activeBtn = document.getElementById(`nav-${tabId.replace('tab-', '')}`);
      if (activeBtn) {
        activeBtn.classList.add('text-cyan-400');
        activeBtn.classList.remove('text-white/50');
      }
    }
  
    document.addEventListener("DOMContentLoaded", () => {
      const userIdFormatted = formatUserId(user.id);
      const displayEl = document.getElementById("user-id-display");
      if (displayEl) displayEl.textContent = userIdFormatted;
  
      const accountId = document.getElementById("account-user-id");
      if (accountId) accountId.textContent = `ID: ${userIdFormatted}`;
  
      const emailEl = document.getElementById("account-user-email");
      if (emailEl) emailEl.textContent = user.email || 'Not available';
  
      showTab("tab-hub");
    });
  </script>
  
  <!-- HUB JS -->
  <script>
    async function fetchUserAccount() {
      try {
        const token = localStorage.getItem("token");
        const response = await fetch("https://earnrave-backend-0c5eddaec35e.herokuapp.com/account/me", {
          headers: {
            Authorization: `Bearer ${token}`
          }
        });
  
        const data = await response.json();
        if (!data || !data.balance || !data.reward_balance) return;
  
        updateHubUI(data);
      } catch (err) {
        console.error("Failed to fetch user account:", err);
      }
    }
  
    function updateHubUI(user) {
      const capital = parseFloat(user.balance || 0);
      const reward = parseFloat(user.reward_balance || 0);
      const total = capital + reward;
  
      const daysPassed = user.days_active || 0; // You can compute this in backend
      const percentGrowth = Math.min(daysPassed, 20); // max 20%
      const profit = (capital * percentGrowth) / 100;
  
      const realAmountEl = document.getElementById("real-balance-amount");
      const availableAmountEl = document.getElementById("real-available-balance");
      const referralBalanceEl = document.getElementById("referral-balance");
      const eyeIcon = document.getElementById("real-balance-eye-icon");
      const percentIncrease = document.getElementById("percentage-increase");
      const profitIncrease = document.getElementById("profit-increase");
  
      window.hubBalance = {
        total,
        available: capital,
        referral: reward,
        profit,
        percentGrowth
      };
  
      window.showRealBalance = true;
  
      window.toggleBalance = function () {
        showRealBalance = !showRealBalance;
        applyBalanceDisplay();
      };
  
      function applyBalanceDisplay() {
        if (showRealBalance) {
          realAmountEl.textContent = `$${total.toFixed(2)}`;
          availableAmountEl.textContent = `$${capital.toFixed(2)}`;
          referralBalanceEl.textContent = `$${reward.toFixed(2)}`;
          percentIncrease.textContent = `+${percentGrowth.toFixed(2)}%`;
          profitIncrease.textContent = `+$${profit.toFixed(2)}`;
          eyeIcon.className = "fa-solid fa-eye text-white/70 text-lg";
        } else {
          realAmountEl.textContent = availableAmountEl.textContent = referralBalanceEl.textContent = "••••••";
          percentIncrease.textContent = "+•••%";
          profitIncrease.textContent = "+$•••••";
          eyeIcon.className = "fa-solid fa-eye-slash text-white/70 text-lg";
        }
      }
  
      applyBalanceDisplay();
    }
  
    document.addEventListener("DOMContentLoaded", fetchUserAccount);
  </script>

  
  <!-- EARN JS -->
  <script>
    async function loadEarnTab() {
      const token = localStorage.getItem("token");
      if (!token) return;
  
      try {
        const res = await fetch("https://earnrave-backend-0c5eddaec35e.herokuapp.com/account/me", {
          headers: { Authorization: `Bearer ${token}` }
        });
        const user = await res.json();
  
        const code = user.referral_code || "N/A";
        const link = `https://earnrave.github.io/index.html?ref=${code}`;
        const count = user.total_referrals || 0;
        const earnings = parseFloat(user.referral_earnings || 0).toFixed(2);
  
        document.getElementById("referral-code").textContent = code;
        document.getElementById("referral-link").textContent = link;
        document.getElementById("referral-link").setAttribute("data-link", link);
        document.getElementById("referral-count").textContent = count;
        document.getElementById("account-referral-earnings").textContent = `$${earnings}`;
      } catch (err) {
        console.error("Error loading earn tab:", err);
      }
    }
  
    document.getElementById("copy-btn")?.addEventListener("click", () => {
      const link = document.getElementById("referral-link").getAttribute("data-link");
      if (!link) return;
      navigator.clipboard.writeText(link).then(() => {
        const status = document.getElementById("copy-status");
        status.classList.remove("hidden");
        setTimeout(() => status.classList.add("hidden"), 1500);
      });
    });
  
    function maskEmail(email) {
      const [name, domain] = email.split("@");
      const masked = name.length > 2 ? name.slice(0, 2) + "****" : name + "****";
      return `${masked}@${domain}`;
    }
  
    function renderLeaderboard(users) {
      const list = document.getElementById("leaderboard");
      list.innerHTML = "";
  
      users.forEach((user, index) => {
        const li = document.createElement("li");
        li.className = "bg-white/5 border border-white/10 rounded-xl px-4 py-3 flex items-center justify-between";
  
        li.innerHTML = `
          <div class="flex items-center space-x-4">
            <div class="text-xl font-bold text-cyan-400">#${index + 1}</div>
            <div>
              <p class="text-white font-semibold text-sm">${maskEmail(user.email || "anonymous")}</p>
              <p class="text-white/60 text-xs">${user.total_referrals || 0} referral${user.total_referrals === 1 ? "" : "s"}</p>
            </div>
          </div>
          <div class="text-right">
            <p class="text-green-400 font-bold text-sm">$${parseFloat(user.reward_balance || 0).toFixed(2)}</p>
            <p class="text-white/40 text-xs">Earned</p>
          </div>
        `;
        list.appendChild(li);
      });
    }
  
    async function loadLeaderboard() {
      try {
        const res = await fetch("https://earnrave-backend-0c5eddaec35e.herokuapp.com/leaderboard");
        const data = await res.json();
  
  
        if (!Array.isArray(data)) {
          console.warn("Expected an array, got:", data);
          return;
        }
  
        renderLeaderboard(data.slice(0, 10));
      } catch (err) {
        console.error("Leaderboard error:");
      }
    }
  
    document.addEventListener("DOMContentLoaded", () => {
      loadEarnTab();
      loadLeaderboard();
    });
  </script>
  
  

  <!-- TRADE JS -->
   <script>
    let botRunning = localStorage.getItem('botRunning') === 'true';
let capital = parseFloat(localStorage.getItem('capital')) || 1000;
let profitTarget = capital * 1.2;
let days = parseInt(localStorage.getItem('botDays')) || 0;

const vix75PriceText = document.getElementById('vix75-price');
const botCapital = document.getElementById('bot-capital');
const botProfit = document.getElementById('bot-profit');
const botDays = document.getElementById('bot-days');
const botProgress = document.getElementById('bot-progress');
const botProgressLabel = document.getElementById('bot-progress-label');
const botLoopProgress = document.getElementById('bot-loop-progress');
const botActionLabel = document.getElementById('bot-action-label');
const startBotBtn = document.getElementById('start-bot');
const stopModal = document.getElementById('stop-modal');
const tradeHistoryBody = document.getElementById('trade-history');

// Deriv WebSocket setup for VIX75
let prevPrice = null;
const priceEl = document.getElementById('vix75-price');
const arrowEl = document.getElementById('vix75-arrow');
const sparklineCanvas = document.getElementById('vix75-sparkline');
let sparklineData = [];

const ws = new WebSocket('wss://ws.binaryws.com/websockets/v3?app_id=1089');
ws.onopen = () => ws.send(JSON.stringify({ ticks: "R_75", subscribe: 1 }));

ws.onmessage = (msg) => {
  const data = JSON.parse(msg.data);
  if (!data.tick) return;

  const price = parseFloat(data.tick.quote);
  latestVix75Price = price;

  // Color & Arrow Logic
  if (prevPrice !== null) {
    if (price > prevPrice) {
      priceEl.className = 'text-green-400';
      arrowEl.textContent = '▲';
      arrowEl.className = 'text-green-400';
    } else if (price < prevPrice) {
      priceEl.className = 'text-red-400';
      arrowEl.textContent = '▼';
      arrowEl.className = 'text-red-400';
    } else {
      arrowEl.textContent = '';
    }
  }
  prevPrice = price;

  priceEl.textContent = `$${price.toFixed(2)}`;

  // Update Sparkline
  sparklineData.push(price);
  if (sparklineData.length > 30) sparklineData.shift(); // keep last 30 points
  drawSparkline(sparklineData);
};

//sparkline
function drawSparkline(data) {
  const ctx = sparklineCanvas.getContext('2d');
  ctx.clearRect(0, 0, sparklineCanvas.width, sparklineCanvas.height);

  const w = sparklineCanvas.width;
  const h = sparklineCanvas.height;
  const max = Math.max(...data);
  const min = Math.min(...data);
  const stepX = w / (data.length - 1 || 1);

  ctx.beginPath();
  ctx.strokeStyle = '#22d3ee'; // cyan-400
  ctx.lineWidth = 1.5;

  data.forEach((v, i) => {
    const x = i * stepX;
    const y = h - ((v - min) / (max - min || 1)) * h;
    i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
  });

  ctx.stroke();
}



function updateBotUI(current) {
  botCapital.textContent = `$${current.toFixed(4)}`;
  botProfit.textContent = `$${(current - capital).toFixed(4)}`;
  const progress = ((current - capital) / (profitTarget - capital)) * 100;
  botProgress.style.width = `${progress}%`;
  botProgressLabel.textContent = `${progress.toFixed(1)}%`;
}

function animateCapital() {
  let current = parseFloat(localStorage.getItem('botCurrent')) || capital;
  const step = (profitTarget - capital) / (30 * 24 * 60 * 60);
  const interval = setInterval(() => {
    if (!botRunning || current >= profitTarget) return clearInterval(interval);
    current += step;
    updateBotUI(current);
    localStorage.setItem('botCurrent', current);
  }, 1000);
}

function loopContractAnimation() {
  const stages = ['Buying Contract', 'Contract Bought', 'Contract Closed'];
  let i = 0;
  setInterval(() => {
    if (!botRunning) return;
    botActionLabel.textContent = stages[i % 3];
    botLoopProgress.style.width = `${(i % 3 + 1) * 33.3}%`;
    i++;
  }, 1000);
}

function saveBotState() {
  localStorage.setItem('botRunning', botRunning);
  localStorage.setItem('botDays', days);
}

function addTradeToTable(trade) {
  const row = document.createElement('tr');
  row.innerHTML = `
    <td class="px-2 py-2">${trade.time}</td>
    <td class="px-2 py-2 text-red-400">${trade.contractsLost}</td>
    <td class="px-2 py-2 text-green-400">${trade.contractsWon}</td>
    <td class="px-2 py-2">$${trade.totalStake.toFixed(2)}</td>
    <td class="px-2 py-2">$${trade.buyPrice.toFixed(2)}</td>
    <td class="px-2 py-2">${trade.status}</td>
  `;
  tradeHistoryBody.prepend(row);
}

function simulateTrade() {
  if (!botRunning || !latestVix75Price) return;

  const current = parseFloat(localStorage.getItem('botCurrent')) || capital;
  const now = new Date();
  const stakePercent = 0.02; // 2% of capital
  const stake = +(current * stakePercent).toFixed(2);
  const win = Math.random() < 0.8;
  const profitLoss = win ? +(stake * 0.9).toFixed(2) : -stake;

  const trade = {
    time: now.toLocaleTimeString(),
    timestamp: now.toISOString(),
    contractsWon: win ? 1 : 0,
    contractsLost: win ? 0 : 1,
    totalStake: stake,
    buyPrice: latestVix75Price,
    profitLoss,
    status: win ? 'Won' : 'Lost'
  };

  addTradeToTable(trade);

  let history = JSON.parse(localStorage.getItem('tradeHistory')) || [];
  history.push(trade);
  localStorage.setItem('tradeHistory', JSON.stringify(history));
}


function cleanupOldTrades() {
  const oneDayAgo = Date.now() - 86400000;
  let history = JSON.parse(localStorage.getItem('tradeHistory')) || [];
  history = history.filter(t => new Date(t.timestamp).getTime() > oneDayAgo);
  localStorage.setItem('tradeHistory', JSON.stringify(history));
}

function loadTradeHistory() {
  cleanupOldTrades();
  const history = JSON.parse(localStorage.getItem('tradeHistory')) || [];
  history.forEach(addTradeToTable);
}

startBotBtn.addEventListener('click', () => {
  if (!botRunning) {
    if (capital <= 0) return alert('Make a deposit first to use the bot.');
    botRunning = true;
    startBotBtn.innerHTML = '<i class="fas fa-stop"></i> <span>Stop Bot</span>';
    saveBotState();
    animateCapital();
    loopContractAnimation();
    const dayInterval = setInterval(() => {
      if (!botRunning || days >= 30) return clearInterval(dayInterval);
      days++;
      botDays.textContent = days;
      saveBotState();
    }, 86400000);
  } else {
    stopModal.classList.remove('hidden');
  }
});

document.getElementById('cancel-stop').onclick = () => stopModal.classList.add('hidden');
document.getElementById('confirm-stop').onclick = () => {
  stopModal.classList.add('hidden');
  botRunning = false;
  startBotBtn.innerHTML = '<i class="fas fa-play"></i> <span>Start Bot</span>';
  localStorage.setItem('botRunning', false);
};

setInterval(() => {
  if (botRunning) simulateTrade();
}, 5000);

window.onload = () => {
  updateBotUI(parseFloat(localStorage.getItem('botCurrent')) || capital);
  botDays.textContent = days;
  loadTradeHistory();
  if (botRunning) {
    startBotBtn.innerHTML = '<i class="fas fa-stop"></i> <span>Stop Bot</span>';
    animateCapital();
    loopContractAnimation();
  }
};

   </script>
 
    let botRunning = localStorage.getItem('botRunning') === 'true';
    let capital = parseFloat(localStorage.getItem('capital')) || 1000;
    let profitTarget = capital * 1.2;
    let days = parseInt(localStorage.getItem('botDays')) || 0;
  
    const botCapital = document.getElementById('bot-capital');
    const botProfit = document.getElementById('bot-profit');
    const botDays = document.getElementById('bot-days');
    const botProgress = document.getElementById('bot-progress');
    const botProgressLabel = document.getElementById('bot-progress-label');
    const botLoopProgress = document.getElementById('bot-loop-progress');
    const botActionLabel = document.getElementById('bot-action-label');
    const startBotBtn = document.getElementById('start-bot');
    const stopModal = document.getElementById('stop-modal');
  
    function updateBotUI(current) {
      botCapital.textContent = `$${current.toFixed(4)}`;
      botProfit.textContent = `$${(current - capital).toFixed(4)}`;
      const progress = ((current - capital) / (profitTarget - capital)) * 100;
      botProgress.style.width = `${progress}%`;
      botProgressLabel.textContent = `${progress.toFixed(1)}%`;
    }
  
    function animateCapital() {
      let current = parseFloat(localStorage.getItem('botCurrent')) || capital;
      const step = (profitTarget - capital) / (30 * 24 * 60 * 60);
      const interval = setInterval(() => {
        if (!botRunning || current >= profitTarget) return clearInterval(interval);
        current += step;
        updateBotUI(current);
        localStorage.setItem('botCurrent', current);
      }, 1000);
    }
  
    function loopContractAnimation() {
      const stages = ['Buying Contract', 'Contract Bought', 'Contract Closed'];
      let i = 0;
      setInterval(() => {
        if (!botRunning) return;
        botActionLabel.textContent = stages[i % 3];
        botLoopProgress.style.width = `${(i % 3 + 1) * 33.3}%`;
        i++;
      }, 1000);
    }
  
    function saveBotState() {
      localStorage.setItem('botRunning', botRunning);
      localStorage.setItem('botDays', days);
    }
  
    startBotBtn.addEventListener('click', () => {
      if (!botRunning) {
        if (capital <= 0) return alert('Make a deposit first to use the bot.');
        botRunning = true;
        startBotBtn.innerHTML = '<i class="fas fa-stop"></i> <span>Stop Bot</span>';
        saveBotState();
        animateCapital();
        loopContractAnimation();
        const dayInterval = setInterval(() => {
          if (!botRunning || days >= 30) return clearInterval(dayInterval);
          days++;
          botDays.textContent = days;
          saveBotState();
        }, 86400000);
      } else {
        stopModal.classList.remove('hidden');
      }
    });
  
    document.getElementById('cancel-stop').onclick = () => stopModal.classList.add('hidden');
    document.getElementById('confirm-stop').onclick = () => {
      stopModal.classList.add('hidden');
      botRunning = false;
      startBotBtn.innerHTML = '<i class="fas fa-play"></i> <span>Start Bot</span>';
      localStorage.setItem('botRunning', false);
    };
  
    window.onload = () => {
      updateBotUI(parseFloat(localStorage.getItem('botCurrent')) || capital);
      botDays.textContent = days;
      if (botRunning) {
        startBotBtn.innerHTML = '<i class="fas fa-stop"></i> <span>Stop Bot</span>';
        animateCapital();
        loopContractAnimation();
      }
    }
  </script> -->

<style>
  .neon-track {
    box-shadow: inset 0 0 8px rgba(0, 255, 255, 0.3), inset 0 0 12px rgba(0, 255, 255, 0.2);
    background-color: rgba(255, 255, 255, 0.1);
    border-radius: 999px;
  }

  .neon-fill {
    background: linear-gradient(90deg, #00ffff, #00ccff);
    box-shadow: 0 0 6px #00ffff, 0 0 10px #00ffff, 0 0 14px #00ffff;
    height: 100%;
    border-radius: 999px;
    transition: width 0.3s ease-in-out;
  }
  #vix75-arrow {
  transition: transform 0.2s;
}

</style>

  
  
    
  
   

  <!-- POSITION JS -->
  <!-- <script id="tab-positions-script">
    document.addEventListener("DOMContentLoaded", () => {
      const token = localStorage.getItem("token");
      const backendUrl = "https://earnrave-backend-0c5eddaec35e.herokuapp.com";
  
      const runningList = document.getElementById("running-positions-list");
      const closedList = document.getElementById("closed-positions-list");
  
      if (!runningList || !closedList) {
        console.warn("Missing positions containers.");
        return;
      }
  
      function formatCountdown(expiresAt) {
        const now = new Date();
        const expiry = new Date(expiresAt);
        const diffMs = expiry - now;
        if (diffMs <= 0) return "00:00";
  
        const totalSec = Math.floor(diffMs / 1000);
        const mins = String(Math.floor(totalSec / 60)).padStart(2, '0');
        const secs = String(totalSec % 60).padStart(2, '0');
        return `${mins}:${secs}`;
      }
  
      async function loadPositions() {
        try {
          const res = await fetch(`${backendUrl}/positions/me`, {
            headers: { Authorization: "Bearer " + token },
          });
  
          const positions = await res.json();
          if (!Array.isArray(positions)) return;
  
          runningList.innerHTML = "";
          closedList.innerHTML = "";
  
          positions.forEach(pos => {
            const stake = parseFloat(pos.stake || 0);
            const profit = isNaN(parseFloat(pos.profit)) ? 0 : parseFloat(pos.profit);
            const entry = parseFloat(pos.entry || 0).toFixed(5);
            const expiresAt = new Date(pos.expires_at);
            const isWin = pos.result === "win";
  
            const li = document.createElement("li");
            li.className = "bg-white/10 rounded-lg px-4 py-3 flex justify-between items-center border border-white/10";
  
            if (pos.status === "open") {
              const countdown = formatCountdown(expiresAt);
              li.innerHTML = `
                <div>
                  <p class="font-semibold">${pos.pair}</p>
                  <p class="text-xs text-white/60">Stake: $${stake} @ ${entry}</p>
                  <p class="text-xs text-white/60">Expires in: <span class="countdown" data-expires="${pos.expires_at}">${countdown}</span></p>
                </div>
                <span class="text-xs bg-cyan-400 text-black px-3 py-1 rounded-lg font-bold">Running</span>
              `;
              runningList.appendChild(li);
            } else {
              li.innerHTML = `
                <div>
                  <p class="font-semibold">${pos.pair}</p>
                  <p class="text-xs text-white/60">${pos.result?.toUpperCase() || 'N/A'} • $${stake} @ ${entry}</p>
                  <p class="text-xs text-white/60">Closed</p>
                </div>
                <span class="text-xs ${isWin ? 'bg-green-400 text-black' : 'bg-red-400 text-white'} px-3 py-1 rounded-lg font-bold">
                  ${isNaN(profit) ? "$0.00" : (profit >= 0 ? '+' : '') + "$" + profit.toFixed(2)}
                </span>
              `;
              closedList.appendChild(li);
            }
          });
  
          if (!runningList.children.length) {
            runningList.innerHTML = "<li class='text-gray-400 text-sm'>No running positions</li>";
          }
  
          if (!closedList.children.length) {
            closedList.innerHTML = "<li class='text-gray-400 text-sm'>No closed trades yet</li>";
          }
  
          // Live countdown update
          document.querySelectorAll(".countdown").forEach(span => {
            const expiresAt = new Date(span.dataset.expires);
            const diff = expiresAt - new Date();
            if (diff > 0) {
              const mins = String(Math.floor(diff / 60000)).padStart(2, '0');
              const secs = String(Math.floor((diff % 60000) / 1000)).padStart(2, '0');
              span.textContent = `${mins}:${secs}`;
            } else {
              span.textContent = "00:00";
            }
          });
  
        } catch (err) {
          console.error("Failed to load positions", err);
        }
      }
  
      loadPositions();
      setInterval(loadPositions, 100000); // Refresh every 10s
    });
  </script> -->

  <!--  ACCOUNT JS-->
  <script id="tab-account-script">
    document.addEventListener("DOMContentLoaded", async () => {
      const token = localStorage.getItem("token");
      const user = JSON.parse(localStorage.getItem("user"));
  
      if (!user || !token) {
        window.location.href = "index.html";
        return;
      }
  
      try {
        const res = await fetch("https://earnrave-backend-0c5eddaec35e.herokuapp.com/account/me", {
          headers: { Authorization: "Bearer " + token }
        });
  
        if (!res.ok) throw new Error("Failed to fetch account");
  
        const data = await res.json();
  
        const emailEl = document.getElementById("account-email");
        const raveIdEl = document.getElementById("account-rave-id");
        const balanceEl = document.getElementById("account-balance");
        const earningsEl = document.getElementById("account-referral-earnings");
        const totalEl = document.getElementById("account-total-balance");
  
        if (emailEl) emailEl.textContent = data.email || "N/A";
        if (raveIdEl) raveIdEl.textContent = `#${data.rave_id || "N/A"}`;
        if (balanceEl) balanceEl.textContent = `$${parseFloat(data.balance || 0).toFixed(2)}`;
        if (earningsEl) earningsEl.textContent = `$${parseFloat(data.reward_balance || 0).toFixed(2)}`;
        if (totalEl) totalEl.textContent = `$${parseFloat(data.total_balance || 0).toFixed(2)}`;
  
      } catch (err) {
        console.error("Account tab error:", err);
      }
      if (data.bot_started_at) {
  const started = new Date(data.bot_started_at);
  const now = new Date();
  const daysElapsed = Math.floor((now - started) / (1000 * 60 * 60 * 24));
  const daysRemaining = Math.max(30 - daysElapsed, 0);
  const countdownEl = document.getElementById("bot-countdown");
  if (countdownEl) countdownEl.textContent = `${daysRemaining} day(s)`;
}

    });
  </script>
  
  
  
 
  <!-- TRADING-VIEW JS -->
  <script src="https://s3.tradingview.com/tv.js"></script>
  <script id="tradingview-script">
    function loadMarketsChart() {
      const widgetContainer = document.getElementById("tradingview-markets-widget");
  
      if (!widgetContainer || widgetContainer.hasChildNodes()) return;
  
      new TradingView.widget({
        container_id: "tradingview-markets-widget",
        width: "100%",
        height: 350,
        symbol: "EURUSD",
        interval: "1",
        timezone: "Africa/Lagos",
        theme: "dark",
        style: "1",
        locale: "en",
        allow_symbol_change: true,
        hide_side_toolbar: true,
        hide_legend: true,
        hide_volume: true,
        withdateranges: false,
        details: false,
        hotlist: false,
        studies: [],
        disabled_features: [
          "volume_force_overlay", "show_volume_overlay", "header_compare", "header_indicators",
          "study_templates", "left_toolbar", "control_bar", "context_menus", "pane_context_menu",
          "create_indicator_button", "border_around_the_chart", "main_series_properties",
          "show_owned_styles_button", "save_chart_properties_to_localstorage", "popup_hints",
          "header_screenshot", "header_settings", "header_undo_redo", "header_interval_dialog_button",
          "show_popup_button", "main_series_scale_menu", "datasource_select_dropdown",
          "display_market_status", "symbol_search_hot_key"
        ],
        overrides: {
          "volumePaneSize": "0",
          "mainSeriesProperties.showVolume": false,
          "mainSeriesProperties.candleStyle.upColor": "#FFFFFF",
          "mainSeriesProperties.candleStyle.downColor": "#22d3ee",
          "mainSeriesProperties.candleStyle.borderUpColor": "#FFFFFF",
          "mainSeriesProperties.candleStyle.borderDownColor": "#22d3ee",
          "mainSeriesProperties.candleStyle.wickUpColor": "#FFFFFF",
          "mainSeriesProperties.candleStyle.wickDownColor": "#22d3ee",
          "paneProperties.background": "#1A1D20",
          "paneProperties.vertGridProperties.color": "#2C2F33",
          "paneProperties.horzGridProperties.color": "#2C2F33",
          "scalesProperties.textColor": "#A7A9AC",
          "timeScale.backgroundColor": "#1A1D20",
          "timeScale.textColor": "#A7A9AC",
          "paneProperties.legendProperties.showSeriesTitle": false,
          "paneProperties.legendProperties.showStudyTitles": false
        },
        interval_dialog_options: {
          intervals: ["1", "5", "15", "30"]
        }
      });
    }
  
    document.addEventListener("DOMContentLoaded", () => {
      document.getElementById("nav-trade")?.addEventListener("click", loadMarketsChart);
    });
  </script>
  
</body>
</html>
